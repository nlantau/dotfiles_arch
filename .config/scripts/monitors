#!/bin/sh
# nlantau, 2021-04-24


function setting_laptop {
  xrandr --output \
    eDP1 --mode 1920x1080 --output \
    DP3 --off --output DP1 --off >/dev/null 2>&1
    [[ $? -eq 0 ]] || notify-send "Laptop error"
}

function setting_dual { 
  xrandr --output \
    eDP1 --off --output \
    DP3 --mode 1920x1080 --output \
    DP1 --mode 1920x1080 --right-of DP3 >/dev/null 2>&1
    [[ $? -eq 0 ]] || notify-send "Not Connected"
}

function setting_triple {  
  xrandr --output \
    eDP1 --mode 1920x1080 --output \
    DP3 --mode 1920x1080 --right-of \
    eDP1 --output \
    DP1 --mode 1920x1080 --right-of DP3 >/dev/null 2>&1
    [[ $? -eq 0 ]] || notify-send "Not Connected"
}

function keyrepeat_xcape {
  # key rate, replay
  xset r rate 300 50 || notify-send "xset rate error"
  xset b off || notify-send "xset bell error"

  # Screensaver off
  xset s off
  xset -dpms

  # set SE and Caps -> Ctrl
  setxkbmap se -option 'caps:ctrl_modifier' || notify-send "Setting SE error"

  # If xcape is started, kill it
  ps aux | grep -E 'xcape -e Caps' | grep -v pts >/dev/null 2>&1
  [[ $? -eq 0 ]] && killall xcape

  # Start xcape
  xcape -e 'Caps_Lock=Escape' || notify-send "Setting Caps -> Esc Error"
}



case "$1" in
  "laptop")
    setting_laptop ;
    keyrepeat_xcape ;
    ;;
  "dual")
    setting_dual ;
    keyrepeat_xcape ;
    ;;
  "triple")
    setting_triple ;
    keyrepeat_xcape ;
    ;;
  *)
    notify-send "Multi Monitor Error";;
esac
